!function(a,b,c,d){"use strict";var e=b.sync,f={};b.$=b.$||c,b.$.ajaxSetup({xhrFields:{withCredentials:!0}}),b.sync=function(a,c,f){return d.isUndefined(f.wait)&&(f.wait=!0),e.apply(b,[a,c,f])},f["private"]={},f.MCAP="MCAP",f.APNS="APNS",f.GCM="GCM",f.ASSET="ASSET",f.CHANNEL="CHANNEL",f.PIPELINE="PIPELINE",f.SERVICE_CONNECTION="SERVICE_CONNECTION",f.META_MODEL="META_MODEL",f.SCHEDULER_TASK="SCHEDULER_TASK",f.PUSH_SERVICE="PUSH_SERVICE",f.FILE="d5b8e89f-b912-4c93-a419-866445dd3df3",f.FOLDER="73a7cf45-10b1-4636-84c0-22b5a99692e1",f.STUDIO="F4C7059E-B62B-4600-A7BC-B0CC43E75465",f.Utils={},f.Utils.getUrl=function(a){return"/"===a.charAt(0)&&(a=a.substr(1)),f.application.get("baseUrl")+"/"+a},f.Utils.getComponentType=function(a){return f.PushApp.prototype.isPrototypeOf(a)?f.PUSH_SERVICE:void 0},f.Utils.setAuthenticationEvent=function(a){var b=a.error;return a.error=function(a,c,d){401===a.status&&f.authentication._triggerEvent("unauthorized",arguments),"function"==typeof b&&b(a,c,d)},a},f.Utils.request=function(a){var c={data:a.data||{t:(new Date).getTime()}};return!c.data||"POST"!==a.type&&"PUT"!==a.type||(c.data=JSON.stringify(c.data),c.contentType="application/json"),c=d.extend(a,c),b.ajax(c)};var g=function(a,c){c=c||{};var e,f,g=a,h=c.limit,i=h?c.offset:!1,j=c.page||1,k=c.perPage||30,l=c.filterValues?JSON.parse(JSON.stringify(c.filterValues)):c.filterValues,m=d.clone(c.customUrlParams),n=c.filterDefinition,o=c.sortOrder;this.filterValues=c.filterValues||{},this.customUrlParams=c.customUrlParams||{},this.fields=c.fields,this.filterIsSet=!1,this.getRequestParams=function(a,b,c){if(c.params=c.params||{},"read"===a){var e=this.getFilters();return e&&(c.params.filter=e),JSON.stringify(e)!==JSON.stringify(f)&&(j=1),f=e,k&&j&&(h||d.isUndefined(h))&&(c.params.limit=k,c.params.offset=j>1?k*(j-1):0),o&&(c.params.sortOrder=o),(h||i)&&(c.params.limit=h,c.params.offset=i),h===!1&&delete c.params.limit,this.fields&&(c.params.field=this.fields),this.customUrlParams&&d.extend(c.params,d.result(this,"customUrlParams")),c.params.getNonpagedCount=!0,c}},this.setLimit=function(a){h=a,i=i||0},this.setTotalAmount=function(a){e=a},this.getTotalAmount=function(){return e},this.loadPreviousPage=function(){return j-=1,g.fetch({remove:!1})},this.hasPreviousPage=function(){return j>=1},this.loadNextPage=function(){return j+=1,g.fetch({remove:!1})},this.hasNextPage=function(){return e&&e>g.length},this.getPage=function(){return j},this.getTotalPages=function(){return Math.floor(e/k)},this.setSortOrder=function(a){j=1,o=a},this.getSortOrder=function(){return o},this.setFilters=function(a){d.forEach(a,function(a,b){if(!d.has(this.filterValues,b))throw new Error("Filter named '"+b+"' not found, did you add it to filterValues of the model?");this.filterValues[b]=a},this),this.filterIsSet=!0},this.getFilters=function(){return d.isFunction(n)?n.apply(this):void 0},this.resetFilters=function(){this.filterValues=l?JSON.parse(JSON.stringify(l)):l,this.customUrlParams=m,this.filterIsSet=!1},function(){if(!g instanceof b.Collection)throw new Error("First parameter has to be the instance of a collection")}()},h=function(a,c){var d=a,e=c||{},f=!0,g=e.isSingleSelection||!1,h=e.addPreSelectedToCollection||!1,i=e.unSelectOnRemove,j=c.preSelected,k=new b.Collection,l=function(){if(j instanceof b.Model)g=!0,this.preSelectModel(j);else{if(!(j instanceof b.Collection))throw new Error("The option preSelected has to be either a Backbone Model or Collection");g=!1,this.preSelectCollection(j)}},m=function(a,b){if(a&&a.selectable){var c=k.get(a);c?(d.get(a)?(a.selectable.isInCollection=!0,c.selectable.isInCollection=!0):(a.selectable.isInCollection=!1,c.selectable.isInCollection=!1),a.selectable.select(b),c.selectable.select(b)):a.selectable.unSelect(b),n.call(this,a),o.call(this,a)}},n=function(a){this.listenTo(a.selectable,"change:select",function(){k.get(a)||this.select(a)}.bind(this))},o=function(a){this.listenTo(a.selectable,"change:unselect",function(){k.get(a)&&this.unSelect(a)}.bind(this))},p=function(a,b){j&&(this.isSingleSelection()?j=b:(j.remove(a,{silent:!0}),j.add(b,{silent:!0})))},q=function(a){var b=this.getSelected().get(a);b&&(k.remove(b,{silent:!0}),k.add(a,{silent:!0}),p.call(this,b,a),m.call(this,a,{silent:!0}))};this.getSelected=function(){return k},this.getDisabled=function(){var a=new b.Collection;return f&&d.each(function(b){b.selectable&&b.selectable.isDisabled()&&a.add(b)}),a},this.select=function(a,c){if(c=c||{},!(a instanceof b.Model))throw new Error("The first argument has to be a Backbone Model");a instanceof d.model||(a=new d.model(a.toJSON())),!a.selectable||a.selectable.isDisabled()&&!c.force||(g&&this.unSelectAll(),a.on("change",function(a,b){b=b||{},(b.unset||!a.id||a.id.length<1)&&this.unSelect(a)},this),k.add(a),m.call(this,a,c),this.trigger("change change:add",a,this))},this.selectAll=function(){d.each(function(a){this.select(a)},this)},this.unSelect=function(a,b){b=b||{},k.remove(a),m.call(this,a,b),this.trigger("change change:remove",a,this)},this.unSelectAll=function(){var a=this.getSelected().clone();a.each(function(a){this.unSelect(a)},this)},this.toggleSelectAll=function(){this.allSelected()?this.unSelectAll():this.selectAll()},this.allSelected=function(){var a=this.getDisabled().length;return this.getSelected().length===d.length-a},this.allDisabled=function(){return this.getDisabled().length===d.length},this.isSingleSelection=function(){return g},this.reset=function(){this.unSelectAll(),l.call(this)},this.preSelectModel=function(a){a.id&&(!d.get(a)&&h&&d.add(a),this.select(a,{force:!0,silent:!0}))},this.preSelectCollection=function(a){a.each(function(a){this.preSelectModel(a)},this),a.on("add",function(a){this.preSelectModel(a)},this),a.on("remove",function(a){this.unSelect(a)},this)};var r=function(){if(!(d instanceof b.Collection))throw new Error("The first parameter has to be from type Backbone.Collection");d.on("add",function(a){f=a.selectable.hasDisabledFn,m.call(this,a),q.call(this,a)},this),d.on("remove",function(a){i?this.unSelect(a):m.call(this,a)},this),d.on("reset",function(){i?this.unSelectAll():this.getSelected().each(function(a){m.call(this,a)},this)},this),j&&l.call(this)};r.call(this)},i=function(a,c){var d=a,e=c.selected||!1;this.isInCollection=!1,this.hasDisabledFn="function"==typeof c.isDisabled||!1,this.isDisabled=function(){return this.hasDisabledFn?c.isDisabled.apply(a,arguments):!1},this.isSelected=function(){return e},this.select=function(b){b=b||{},this.isDisabled()&&!b.force||this.isSelected()||(e=!0,b.silent||this.trigger("change change:select",a,this))},this.unSelect=function(b){b=b||{},this.isSelected()&&(e=!1,b.silent||this.trigger("change change:unselect",a,this))},this.toggleSelect=function(){this.isSelected()?this.unSelect():this.select()};var f=function(){if(!(d instanceof b.Model))throw new Error("First parameter has to be the instance of a model")};f.call(this)},i=i||{},h=h||{};d.extend(i.prototype,b.Events),d.extend(h.prototype,b.Events);var j=function(a,c){if(a instanceof b.Model)return new i(a,c);if(a instanceof b.Collection)return new h(a,c);throw new Error("SelectableFactory: instance has to be either a model or a collection")},j=j||{},k=b.Model.extend({idAttribute:"uuid",selectable:!0,selectableOptions:{},queryParameter:null,constructor:function(a,b){this.on("destroy",function(){this.collection&&this.collection.filterable&&this.collection.filterable.getTotalAmount()>0&&this.collection.filterable.setTotalAmount(this.collection.filterable.getTotalAmount()-1)},this),this.selectable&&(this.selectable=new j(this,d.result(this,"selectableOptions"))),"string"==typeof this.endpoint&&this.setEndpoint(this.endpoint);var c=a||{};b=b||{},this.cid=d.uniqueId("c"),this.attributes={},b.collection&&(this.collection=b.collection),this._setNesting(c,b),this.changed={},this.initialize.apply(this,arguments)},_setNesting:function(a,b){b=b||{};var c=this.prepare();this.set(c),b.parse&&(a=this.parse(a,b)||{}),a=d.defaults({},a,c,d.result(this,"defaults")),this.set(a,b)},prepare:function(){return{}},setQueryParameter:function(a,b){this.queryParameter=this.queryParameter||{},"string"==typeof a&&(this.queryParameter[a]=b)},removeQueryParameter:function(a){this.queryParameter&&a&&this.queryParameter[a]&&delete this.queryParameter[a]},getEndpoint:function(){return this.urlRoot()},setEndpoint:function(a){this.urlRoot=function(){return"/"===f.application.get("baseUrl").slice(-1)&&"/"===a[0]?f.application.get("baseUrl")+a.substr(1):"/"!==f.application.get("baseUrl").slice(-1)&&"/"!==a[0]?f.application.get("baseUrl")+"/"+a:f.application.get("baseUrl")+a}},parse:function(a){return a&&a.data&&a.data.results&&a.data.results.length>=0&&"undefined"!=typeof a.data.results[0]?a.data.results[0]:a&&a.data?a.data:a},url:function(){var a=b.Model.prototype.url.apply(this,arguments);return this.queryParameter&&(a+="?"+b.$.param(d.result(this,"queryParameter"))),a},beforeSave:function(a){return a},recursiveBeforeSave:function(a){var c=this.beforeSave(a),e=function(a){if(a instanceof b.Model&&"function"==typeof a.recursiveBeforeSave)return a.recursiveBeforeSave(a.toJSON());if(a instanceof b.Model&&"function"!=typeof a.recursiveBeforeSave)return a.toJSON();if(a instanceof f.EnumerableCollection)return a.toJSON();if(a instanceof b.Collection){var c=[];return a.each(function(a){var b=e(a);c.push(b)}),c}if(d.isArray(a)){var g=[];return d.each(a,function(a){g.push(e(a))}),g}if(d.isObject(a)){var h={};return d.each(a,function(a,b){h[b]=e(a)}),h}return a};return e(c)},save:function(){var a=this.attributes,c=this.parse;this.parse=function(){return this.attributes=a,this.parse=c,this.parse.apply(this,arguments)},this.attributes=this.recursiveBeforeSave(d.clone(a));var e=b.Model.prototype.save.apply(this,arguments);return this.attributes=a,e},clear:function(a){var c=b.Model.prototype.clear.apply(this,arguments);return this._setNesting({},a),c},_triggerEvent:function(a,b){var c=Array.prototype.slice.call(b,0);c.unshift(a),this.trigger.apply(this,c)},sync:function(){return arguments[2]&&(f.Utils.setAuthenticationEvent(arguments[2]),arguments[2].instance=arguments[1]),b.Model.prototype.sync.apply(this,arguments)}});f.Model=k;var l=f.Model.extend({endpoint:"/",defaults:{uuid:null,version:-1},increaseVersionNumber:function(){this.attributes.version+=1},decreaseVersionNumber:function(){this.attributes.version-=1},save:function(a,b,c){"undefined"!=typeof a&&void 0!==a&&null!==a&&"object"!=typeof a||(c=b),c=d.extend({validate:!0},c);var e=c.error,g=this;return g.increaseVersionNumber(),c.error=function(a){g.decreaseVersionNumber(),e&&e(g,a,c)},"undefined"!=typeof a&&void 0!==a&&null!==a&&"object"!=typeof a||(b=c),f.Model.prototype.save.call(this,a,b,c)}});f.Component=l;var g=g||{},j=j||{},m=b.Collection.extend({selectable:!0,filterable:!0,filterableOptions:function(){return{}},selectableOptions:function(){return{}},model:f.Model,constructor:function(){var a=b.Collection.prototype.constructor.apply(this,arguments);return this.selectable&&(this.selectable=new j(this,d.result(this,"selectableOptions"))),this.filterable&&(this.filterable=new g(this,d.result(this,"filterableOptions"))),this.endpoint&&this.setEndpoint(this.endpoint),a},setEndpoint:function(a){this.url=function(){return URI(f.application.get("baseUrl")+"/"+a).normalize().toString()}},parse:function(a){return a.data=a.data||{},this.filterable&&this.filterable.setTotalAmount(a.data.total||a.data.nonpagedCount||0),a.data.results},sync:function(a,c,d){if(this.filterable){var e=this.filterable.getRequestParams.apply(this.filterable,arguments);d=e}return d=f.Utils.setAuthenticationEvent(d),b.Collection.prototype.sync.apply(this,[a,c,d])},replace:function(a){this.reset(a),this.trigger("replace",this)}});f.Collection=m;var g=g||{},j=j||{},n=f.Collection.extend({selectable:!1,filterable:!1,defaults:function(){return[]},parse:function(a){var b=[];return d.each(a.data,function(a){b.push({key:a.value})}),b},toJSON:function(){return this.pluck("key")},model:f.Model.extend({idAttribute:"key"}),constructor:function(){var a=f.Collection.prototype.constructor.apply(this,arguments),b=d.result(this,"defaults");return b.length>0&&d.each(b,function(a){this.add({key:a})},this),a}});f.EnumerableCollection=n;var o=f.Model.extend({defaults:{baseUrl:"",pushServiceApiVersion:"v1"}});f.application=new o;var p=f.Collection.extend({endpoint:"gofer/form/rest/enumerables/pairs/localeCountries",model:f.Model.extend({idAttribute:"value"}),parse:function(a){return a.data}});f.Countries=p;var q=f.Model.extend({defaults:function(){return{allowSimplePassword:!1,maximumPasswordAge:0,minimumNumbersOfDigits:0,minimumNumbersOfLowerCaseLetters:0,minimumNumbersOfUpperCaseLetters:0,minimumPasswordLength:8,requiredNumbersOfSymbols:0}},_test:function(a,b,c){if(0===c)return!0;if(a){var d=a.match(b);return!!(d&&d.length>=c)}return!1},hasEnoughLowerCaseLetters:function(a){var b=this.get("minimumNumbersOfLowerCaseLetters");return this._test(a,/[a-z]/g,b)},hasEnoughUpperCaseLetters:function(a){var b=this.get("minimumNumbersOfUpperCaseLetters");return this._test(a,/[A-Z]/g,b)},hasEnoughDigits:function(a){var b=this.get("minimumNumbersOfDigits");return this._test(a,/[0-9]/g,b)},hasEnoughSymbols:function(a){var b=this.get("requiredNumbersOfSymbols");return this._test(a,/\W/g,b)},isLongEnough:function(a){var b=this.get("minimumPasswordLength");return a&&a.length>=b},isSimple:function(a,b,c){var d=c||window.mCAP.currentOrganization,e=b||window.mCAP.authenticatedUser;if(d.get("uniqueName")&&e.get("name")){var f=d.get("uniqueName"),g=e.get("name");return a===f||a===g}return!1},violatesSimpleRestriction:function(a,b,c){return this.get("allowSimplePassword")?!1:this.isSimple(a,b,c)},getExamplePassword:function(){for(var a="abcdefghijklmnopqrstuvwxyz",b="0123456789",c='!"§$%&/()=?€@+*#,;-',e=this.get("minimumNumbersOfDigits"),f=this.get("minimumNumbersOfLowerCaseLetters"),g=this.get("minimumNumbersOfUpperCaseLetters"),h=this.get("requiredNumbersOfSymbols"),i=this.get("minimumPasswordLength"),j="",k=0;e>k;k++)j+=b.charAt(Math.floor(Math.random()*b.length));for(var l=0;h>l;l++)j+=c.charAt(Math.floor(Math.random()*c.length));for(var m=0;g>m;m++)j+=a.charAt(Math.floor(Math.random()*a.length)).toUpperCase();for(var n=0;f>n;n++)j+=a.charAt(Math.floor(Math.random()*a.length));if(j.length<i)for(var o=i-j.length,p=0;o>p;p++)j+=a.charAt(Math.floor(Math.random()*a.length));return d.shuffle(j.split("")).join("")}});f.PasscodePolicy=q;var r=f.Model.extend({endpoint:"gofer/security/rest/organizations",defaults:function(){return{name:"",uniqueName:""}},prepare:function(){return{passcodePolicy:new f.PasscodePolicy,user:new(f.User.extend({prepare:function(){return{groups:new f.Groups}},initialize:function(){}}))}},beforeSave:function(a){return a.passwordPolicy=this.get("passcodePolicy").toJSON(),delete a.passcodePolicy,this.isNew()&&(a.orgaName=a.uniqueName,a.orgaFullName=a.name,a.orgaContactName=this.get("user").getFullName(),a.orgaContactEMail=this.get("user").get("email"),a.orgaAdminUser=this.get("user").get("name"),a.orgaAdminGivenName=this.get("user").get("givenName"),a.orgaAdminSurName=this.get("user").get("surname"),a.orgaAdminPwd=this.get("user").get("password"),a.orgaAdminEmail=this.get("user").get("email")),delete a.user,a},setReferencedCollections:function(a){return!a.passwordPolicy||a.passwordPolicy instanceof f.PasscodePolicy||!this.get("passcodePolicy")||(this.get("passcodePolicy").set(a.passwordPolicy),delete a.passwordPolicy),a.createdUser&&this.get("user").set("uuid",a.createdUser),a},set:function(a,b,c){return a=this.setReferencedCollections(a),f.Model.prototype.set.apply(this,[a,b,c])},parse:function(){var a=f.Model.prototype.parse.apply(this,arguments);return a.orgaId&&(a.uuid=a.orgaId,delete a.orgaId),a.orgaName&&(a.uniqueName=a.orgaName,delete a.orgaName),this.setReferencedCollections(a)},save:function(){var a=this.getEndpoint();return this.isNew()&&this.setEndpoint("relution/api/v1/wizard"),f.Model.prototype.save.apply(this,arguments).then(function(b){return this.setEndpoint(a),b}.bind(this))},destroy:function(){var a=this.getEndpoint();return this.setEndpoint("relution/api/v1/cleanup"),f.Model.prototype.destroy.apply(this,arguments).then(function(b){return this.setEndpoint(a),b}.bind(this))},makeLicenseHandshake:function(){var a={url:this.url()+"/handshake-license",type:"POST",instance:this};return window.mCAP.Utils.request(a).then(function(a){return this.set(a.data),this}.bind(this))}});f.Organization=r;var s=f.Organization.extend({sync:function(){var a=arguments;if(this.get("uuid"))return f.Organization.prototype.sync.apply(this,arguments);var b=new window.Backbone.$.Deferred;return f.currentOrganization.once("change:uuid",function(){this.initialize(),f.Organization.prototype.sync.apply(this,a).then(function(a){b.resolve(a)},function(a){b.reject(a)})},this),b.promise()},initialize:function(){this.set("uuid",f.currentOrganization.get("uuid"))}});f.CurrentOrganization=s;var t=f.Collection.extend({endpoint:"gofer/security/rest/organizations",model:f.Organization,parse:function(a){return a.data.items},filterableOptions:function(){return{sortOrder:"+name",filterValues:{search:"",strictSearch:!1,name:""},customUrlParams:{getNonpagedCount:!0},filterDefinition:function(){var a,b=new f.Filter,c=[];return this.filterValues.strictSearch?c.push(b.string("uniqueName",this.filterValues.name)):c.push(b.containsString("uniqueName",this.filterValues.name)),a=[b.containsString("name",this.filterValues.search),b.containsString("uniqueName",this.filterValues.search)],c.push(b.or(a)),b.and(c)}}}});f.Organizations=t;var u=f.Organizations.extend({filterableOptions:function(){var a=f.Organizations.prototype.filterableOptions.apply(this,arguments);return a.limit=!1,a.fields=["uuid","name"],a}});f.AllOrganizations=u;var v=f.Model.extend({endpoint:"gofer/form/rest/enumerables/paginatedPairs/roles",prepare:function(){return{users:new f.Users,groups:new f.Groups}},setReferencedCollections:function(a){var b=d.where(a,{type:"USER"}),c=d.where(a,{type:"GROUP"});return this.get("users")&&b.length>0&&(b.forEach(function(a){a.organizationUuid=this.get("organizationUuid")},this),this.get("users").add(b),delete a.users),this.get("groups")&&c.length>0&&(c.forEach(function(a){a.organizationUuid=this.get("organizationUuid")},this),this.get("groups").add(d.where(a,{type:"GROUP"})),delete a.groups),a},parse:function(){var a=f.Model.prototype.parse.apply(this,arguments);return this.setReferencedCollections(a)},set:function(a,b,c){return a=this.setReferencedCollections(a),f.Model.prototype.set.apply(this,[a,b,c])}}),w=f.Model.extend({endpoint:"gofer/security/rest/groups",defaults:function(){return{uuid:null,name:"",version:0,description:null,roles:null,members:null,aclEntries:[],effectivePermissions:"",sysRoles:[],systemPermission:!1,bundle:null}},prepare:function(){return{roles:new v,members:new v,organization:new f.Organization}},validate:function(a){return!a.organizationUuid||a.organizationUuid.length<1?"Missing organization uuid":void 0},beforeSave:function(a){return a.organizationUuid=this.get("organization").get("uuid"),delete a.organization,a.roles&&(a.roles=d.union(this.get("roles").get("users").pluck("uuid"),this.get("roles").get("groups").pluck("uuid"))),a.members&&(a.members=d.union(this.get("members").get("users").pluck("uuid"),this.get("members").get("groups").pluck("uuid"))),a},setReferencedCollections:function(a){return a.organizationUuid&&(this.get("organization").set({uuid:a.organizationUuid}),delete a.organizationUuid),a.rolesObjects&&(this.get("roles").set("organizationUuid",this.get("organization").get("uuid")),this.get("roles").set(a.rolesObjects),delete a.rolesObjects,delete a.roles),a.membersObjects&&(this.get("members").set("organizationUuid",this.get("organization").get("uuid")),this.get("members").set(a.membersObjects),delete a.membersObjects,delete a.members),a},set:function(a,b,c){return a=this.setReferencedCollections(a),f.Model.prototype.set.apply(this,[a,b,c])},parse:function(a){return a=a.data||a,this.setReferencedCollections(a)},isSystemGroup:function(){var a=this.get("groupType");return"SYSTEM_GROUP"===a||"SYSTEM_PERMISSION"===a},_setDefaultOrgaUuid:function(){var a=this.get("organization"),b=a.get("uuid"),c=f.currentOrganization.get("uuid");!b&&c&&a.set("uuid",c)},initialize:function(){this._setDefaultOrgaUuid(),f.currentOrganization.once("change:uuid",this._setDefaultOrgaUuid,this)}});f.Group=w;var x=f.Collection.extend({endpoint:"gofer/security/rest/groups",model:f.Group,parse:function(a){return this.filterable.setTotalAmount(a.data.nonpagedCount),a.data.items},filterableOptions:function(){return{sortOrder:"+name",filterValues:{name:"",uuid:"",groupType:"",members:[],strictSearch:!1,organizationUuid:""},customUrlParams:{getNonpagedCount:!0},fields:["uuid","name","description","readonly","groupType","organizationUuid"],filterDefinition:function(){var a=new f.Filter,b=[];return this.filterValues.strictSearch?b.push(a.string("name",this.filterValues.name)):b.push(a.containsString("name",this.filterValues.name)),""===this.filterValues.groupType?b.push(a.stringEnum("groupType",["GROUP","SYSTEM_GROUP"])):b.push(a.stringEnum("groupType",this.filterValues.groupType)),b.push(a.string("members",this.filterValues.members)),b.push(a.string("uuid",this.filterValues.uuid)),b.push(a.string("organizationUuid",this.filterValues.organizationUuid)),a.and(b)}}},systemGroupIsSelected:function(){var a=!1;return this.selectable.getSelected().each(function(b){a||(a=b.isSystemGroup())}),a}});f.Groups=x;var y=f.Model.extend({endpoint:"gofer/security/rest/users",defaults:function(){return{uuid:null,name:"",salutation:null,givenName:"",surname:"",position:null,email:"",phone:null,country:null,password:"",locked:!1,activated:!0,version:0,aclEntries:[],groups:null}},prepare:function(){return{groups:new f.Groups,organization:new f.Organization}},beforeSave:function(a){return a.roles=this.get("groups").pluck("uuid"),a.organizationUuid=this.get("organization").get("uuid"),delete a.groups,delete a.organization,delete a.authenticated,""!==a.password&&null!==a.password||delete a.password,""!==a.phone&&null!==a.phone||delete a.phone,a},setReferencedCollections:function(a){return a.organizationUuid&&(this.get("organization").set({uuid:a.organizationUuid}),delete a.organizationUuid),!a.rolesObjects||a.rolesObjects instanceof f.Groups||!this.get("groups")||(a.rolesObjects.forEach(function(a){a.organizationUuid=this.get("organization").get("uuid")}.bind(this)),this.get("groups").add(a.rolesObjects),delete a.rolesObjects,delete a.roles),!a.roles||a.roles instanceof f.Groups||!this.get("groups")||(this.get("groups").add(a.roles),delete a.roles),a},parse:function(a){var b=a.data||a;return this.setReferencedCollections(b)},set:function(a,b,c){return a=this.setReferencedCollections(a),f.Model.prototype.set.apply(this,[a,b,c])},loginAs:function(){var a={url:"/gofer/security-login-as",type:"GET",params:{j_user_uuid:this.get("uuid")},instance:this};return window.mCAP.Utils.request(a)},resetPassword:function(){var a={url:this.getEndpoint()+"/createPasswordResetRequest",type:"PUT",params:{userIdentifier:this.get("name"),organizationName:f.currentOrganization.get("uniqueName")},instance:this};return window.mCAP.Utils.request(a)},changePassword:function(a){var b={url:this.getEndpoint()+"/"+this.get("uuid")+"/changePassword",type:"PUT",data:{newPassword:a},instance:this};return window.mCAP.Utils.request(b)},isLocked:function(){return this.get("readonly")||this.get("locked")},getFullName:function(){return this.get("givenName")&&this.get("surname")?this.get("givenName")+" "+this.get("surname"):this.get("name")?this.get("name"):!1},_setDefaultOrgaUuid:function(){var a=this.get("organization"),b=a.get("uuid"),c=f.currentOrganization.get("uuid");!b&&c&&a.set("uuid",c)},initialize:function(){this._setDefaultOrgaUuid(),f.currentOrganization.once("change:uuid",this._setDefaultOrgaUuid,this)}});f.User=y;var z=f.Collection.extend({endpoint:"gofer/security/rest/users",model:f.User,parse:function(a){return this.filterable&&this.filterable.setTotalAmount(a.data.nonpagedCount),a.data.items},filterableOptions:function(){return{sortOrder:"+name",filterValues:{search:"",strictSearch:!1,name:"",organizationUuid:""},customUrlParams:{getNonpagedCount:!0},filterDefinition:function(){var a,b=new f.Filter,c=[];return this.filterValues.strictSearch?c.push(b.string("name",this.filterValues.name)):c.push(b.containsString("name",this.filterValues.name)),c.push(b.string("organizationUuid",this.filterValues.organizationUuid)),a=[b.containsString("name",this.filterValues.search),b.containsString("givenName",this.filterValues.search),b.containsString("surname",this.filterValues.search),b.containsString("email",this.filterValues.search)],c.push(b.or(a)),b.and(c)}}}});f.Users=z;var A=f.Model.extend({hasPreferences:!0,setUserId:function(a){this.setEndpoint("gofer/security/rest/users/"+a+"/preferences")},parse:function(a){return a.data},save:function(a){return b.ajax(d.extend({url:d.result(this,"url"),data:this.toJSON(),type:"PUT"},a))}}),B=f.User.extend({defaults:function(){return d.extend(f.User.prototype.defaults.apply(this,arguments),{authenticated:!1})},prepare:function(){var a=f.User.prototype.prepare.apply(this,arguments);return d.extend(a,{preferences:new A})},changePassword:function(a,b){return window.mCAP.Utils.request({url:this.url()+"/changePassword",data:{password:a,newPassword:b},instance:this,type:"PUT"})},beforeSave:function(a){return delete a.preferences,f.User.prototype.beforeSave.call(this,a)},set:function(a,b,c){return a=this.setReferencedCollections(a),f.User.prototype.set.apply(this,[a,b,c])},setReferencedCollections:function(a){return f.User.prototype.setReferencedCollections.apply(this,[a]),!a.preferences||a.preferences instanceof f.Model||!this.get("preferences")||(a.preferences=d.omit(a.preferences,function(a,b){return b.match(/^custom/)&&""===a}),this.get("preferences").set(a.preferences),this.get("preferences").hasPreferences=!0,delete a.preferences),null===a.preferences&&(this.get("preferences").hasPreferences=!1,delete a.preferences),!a.organization||a.organization instanceof f.Model||!this.get("organization")||(this.get("organization").set(a.organization),delete a.organization),null===a.organization&&delete a.organization,a},parse:function(a){var b=f.User.prototype.parse.apply(this,[a]);return this.setReferencedCollections(b)},initialize:function(){this.on("change:"+this.idAttribute,function(a){a&&a.id&&(this.get("preferences").setUserId(a.id),this.set("authenticated",!0))},this)},hasRoleWithUuid:function(a){return!!this.get("groups").findWhere({uuid:a})}});f["private"].UserPreferences=A,f["private"].AuthenticatedUser=B;var C=f.Model.extend({defaults:{user:null,authenticated:!1},endpoint:"gofer/security/rest/auth/",prepare:function(){return{user:new f["private"].AuthenticatedUser}},logout:function(){var a=this;return f.Utils.request({url:this.url()+"logout",type:"POST"}).always(function(){a.set({authenticated:!1}),a.set("user",new f["private"].AuthenticatedUser),f.authenticatedUser=f.authentication.get("user"),f.currentOrganization=f.authentication.get("user").get("organization"),a._triggerEvent("logout",arguments)})},setReferencedModels:function(a){return!a.user||a.user instanceof f["private"].AuthenticatedUser||!this.get("user")||(this.get("user").set(a.user),delete a.user),!a.organization||a.organization instanceof f.Organization||!this.get("user").get("organization")||(this.get("user").get("organization").set(a.organization),delete a.organization),a},parse:function(a){return this.setReferencedModels(a)},set:function(a,b,c){return a=this.setReferencedModels(a),f.Model.prototype.set.apply(this,[a,b,c])},isAuthenticated:function(){var a=c.Deferred(),b=this;return f.Utils.request({url:f.Utils.getUrl("/gofer/system/security/currentAuthorization"),type:"GET"}).then(function(c){c.data.user&&c.data.user.uuid&&(b.set({authenticated:!0}),a.resolve(b)),b.set({authenticated:!1}),a.reject("not authenticated",c.data)},function(b){a.reject(b)}),a.promise()},initialize:function(){}},{requestNewPassword:function(a,b){return f.Utils.request({url:f.Utils.getUrl("/gofer/security/rest/users/requestNewPassword"),data:{userIdentifier:a,organizationName:b},type:"PUT"})},resetPassword:function(a,b,c){var e={url:f.Utils.getUrl("/gofer/security/rest/users/resetPasswordSafely"),data:{newPassword:a,requestUuid:b},type:"PUT"};return d.extend(e,c),f.Utils.request(e)},login:function(a,b,c){return f.Utils.request({url:f.Utils.getUrl(C.prototype.endpoint+"login"),data:{userName:(c?c+"\\":"")+a,password:b},type:"POST"}).then(function(a){return f.authentication.set({authenticated:!0}),f.authentication.set(a),f.authentication})},canRegister:function(){return f.Utils.request({url:f.Utils.getUrl("/relution/api/v1/registration/available"),type:"GET"}).then(function(a){return 200===a.status},function(){return!1})},register:function(a){return a=a||{},f.Utils.request({url:f.Utils.getUrl("/relution/api/v1/registration"),type:"POST",data:a})}});f.authentication=new C,f.Authentication=C,f.authenticatedUser=f.authentication.get("user"),f.currentOrganization=f.authentication.get("user").get("organization"),C.prototype.initialize=function(){throw new Error("You can not instantiate a second Authentication object please use the mCAP.authentication instance")};var D=f.Collection.extend({endpoint:"",push:null,setEndpoint:function(a){this.url=function(){return URI(this.push.url()+a).normalize().toString()}},initialize:function(a,b){return this.push=b,f.Collection.prototype.initialize.apply(this,arguments)}});f.PushAppAttributeCollection=D;var E=f.Model.extend({idAttribute:"uuid",defaults:{providerType:f.MCAP,user:"",vendor:"",name:"",osVersion:"",language:"de",country:"DE",tags:null,badge:0,appPackageName:null,type:null,appVersion:null,model:null,attributes:null,token:""},initialize:function(a){return this.attributes.tags=a.tags||[],this.attributes.attributes=a.attributes||{},f.Model.prototype.initialize.apply(this,arguments)}});f.Device=E;var F=f.PushAppAttributeCollection.extend({endpoint:"/devices",model:f.Device,parse:function(a){return a&&a.items?a.items:a}});f.Devices=F;var G=f.Model.extend({idAttribute:"uuid",defaults:{message:"",sound:"",deviceFilter:null,badge:0,extras:null},sendPush:function(){return this.save.apply(this,arguments)}});f.Job=G;var H=f.PushAppAttributeCollection.extend({endpoint:"/jobs",model:f.Job,parse:function(a){return a&&a.items?a.items:a}});f.Jobs=H;var I=f.PushAppAttributeCollection.extend({tags:null,endpoint:"/tags",parse:function(a){this.tags=a},get:function(a){return"tag"===a||"tags"===a?this.tags:f.PushAppAttributeCollection.prototype.get.apply(this,arguments)},set:function(a,b){return"tag"===a||"tags"===a?(this.tags=b,this):f.PushAppAttributeCollection.prototype.set.apply(this,arguments)}});f.Tags=I;var J=f.Model.extend({endpoint:"/apnsProvider",defaults:{certificate:null,passphrase:null},initialize:function(a,b){return this.push=b,f.Model.prototype.initialize.apply(this,arguments)},upload:function(){return this.sync()},setEndpoint:function(a){this.url=function(){return URI(this.push.url()+a).normalize().toString()}},sync:function(a,e,f){e=e||this;var g=new FormData;return g.append("passphrase",this.get("passphrase")),g.append("certificate",this.get("certificate")),d.defaults(f||(f={}),{url:this.url(),data:g,type:"PUT",processData:!1,contentType:!1,xhr:function(){var a=c.ajaxSettings.xhr();return a.upload.onprogress=function(a){e.trigger("progress",a.loaded/a.total*100)},a.upload.onload=function(){e.trigger("progress",100)},a}}),b.sync.call(this,a,e,f).then(function(a){return e.push.update(a),arguments})}});f.ApnsProvider=J;var K=f.Component.extend({endpoint:"push/api/"+f.application.get("pushServiceApiVersion")+"/apps/",idAttribute:"uuid",defaults:{uuid:null,name:"",apnsProvider:null,gcmProvider:null,version:-1,effectivePermissions:"*"},tags:null,jobs:null,devices:null,initialize:function(){
var a=this,b=function(){return a.url()},c=function(b){return a.set("apnsProvider",b)};return this.tags=new f.Tags(null,{url:b}),this.jobs=new f.Jobs(null,{url:b}),this.devices=new f.Devices(null,{url:b}),this.apnsProvider=new f.ApnsProvider(null,{url:b,update:c}),f.Model.prototype.initialize.apply(this,arguments)},fetch:function(){return c.when(this.devices.fetch(),this.tags.fetch(),this.jobs.fetch(),f.Model.prototype.fetch.apply(this,arguments))}});f.PushApp=K;var L=f.Collection.extend({endpoint:"push/api/"+f.application.get("pushServiceApiVersion")+"/apps/",model:f.PushApp,parse:function(a){return a&&a.items?a.items:a}});f.PushApps=L,f.push=new f.PushApp,f.PushNotification=function(a){a=a||{};var b=this,c={};a.pushServiceId?c.uuid=a.pushServiceId:console.info("no pushServiceId was given to the PushNotification. Please specify one to use the API"),this.pushApp=new f.PushApp(c),delete a.pushServiceId,this.senderId="undefined"!=typeof a.senderId?a.senderId:this.senderId,delete a.senderId,this.device=this.pushApp.devices.add(a,{url:function(){return b.pushApp.url()}})},f.PushNotification.prototype.trigger=b.Model.prototype.trigger,f.PushNotification.prototype.on=b.Model.prototype.on,f.PushNotification.prototype.off=b.Model.prototype.off,f.PushNotification.prototype.senderId=null,f.PushNotification.prototype.pushApp=null,f.PushNotification.prototype.device=null,f.PushNotification.prototype.set=function(a,b){return"pushServiceId"===a?this.pushApp.set("uuid",b):"senderId"===a?this.senderId=b:this.device.set(a,b),this},f.PushNotification.prototype.get=function(a){return"undefined"!=typeof this.device.get(a)?this.device.get(a):"undefined"!=typeof this.pushApp.get(a)?this.pushApp.get(a):"pushServiceId"===a?this.pushApp.get("uuid"):"senderId"===a?this.senderId:null},f.PushNotification.prototype.getConfiguration=function(){return this.pushApp.toJSON()},f.PushNotification.prototype.addAttribute=function(a,b){return this.device.attributes.attributes[a]=b,this},f.PushNotification.prototype.removeAttribute=function(a){return delete this.device.attributes.attributes[a],this},f.PushNotification.prototype.addAttributes=function(a){return this.device.attributes.attributes=d.extend(this.device.attributes.attributes,a),this},f.PushNotification.prototype.removeAttributes=function(a){return"string"==typeof a&&(a=Array.prototype.slice.call(arguments,0)),a.unshift(this.device.attributes.attributes),this.device.attributes.attributes=d.omit.apply(d,a),this},f.PushNotification.prototype.putAttributeValue=function(a,b){return this.addAttribute(a,b),this},f.PushNotification.prototype.addTag=function(a){return this.addTags([a]),this},f.PushNotification.prototype.removeTag=function(a){return this.removeTags([a])},f.PushNotification.prototype.addTags=function(a){return this.device.attributes.tags=d.union(this.device.attributes.tags,a||[]),this},f.PushNotification.prototype.removeTags=function(a){return this.device.attributes.tags=d.difference(this.device.attributes.tags,a||[]),this},f.PushNotification.prototype.subscribeTag=function(a){return this.addTag(a),this},f.PushNotification.prototype.subscribeTags=function(a){return this.addTags(a),this},f.PushNotification.prototype.setAttributes=function(a,b){return this.addAttribute(a,b),this},f.PushNotification.prototype.setCountry=function(a){return this.set("country",a),this},f.PushNotification.prototype.setCurrentBadge=function(a){return this.set("badge",a),this},f.PushNotification.prototype.setToken=function(a){return this.set("token",a),this},f.PushNotification.prototype.setLanguage=function(a){return this.set("language",a),this},f.PushNotification.prototype.setModel=function(a){return this.set("model",a),this},f.PushNotification.prototype.setUser=function(a){return this.set("name",a),this},f.PushNotification.prototype.unsubscribeTag=function(a){return this.removeTag(a),this},f.PushNotification.prototype.unregisterDevice=function(){if(this.device.isNew()){var a=new c.Deferred;return a.reject("device was not saved before"),a.promise()}return this.device.destroy()},f.PushNotification.prototype.registerDevice=function(){return this.device.save()},f.PushNotification.prototype.save=function(){return this.device.save()},f.PushNotification.prototype.sendStatusBarNotification=function(){return console.info("needs to be implemented by the specific implementation"),this},f.PushNotification.prototype.showToastNotification=function(){return console.info("needs to be implemented by the specific implementation"),this},f.PushNotification.prototype.updateDeviceBadge=function(){return console.info("needs to be implemented by the specific implementation"),this},f.PushNotification.prototype.register=function(){return console.info("needs to be implemented by the specific implementation"),this},f.PushNotification.prototype.unregister=function(){return console.info("needs to be implemented by the specific implementation"),this};var M=function(){var a=function(a,b){return d.isUndefined(a)||null===a||""===a||0===a.length||d.isArray(a)&&0===d.compact(a).length?null:b};return{containsString:function(b,c){return a(c,{type:"containsString",fieldName:b,contains:c})},string:function(b,c){return a(c,{type:"string",fieldName:b,value:c})},and:function(a){return this.logOp(a,"AND")},nand:function(a){return this.logOp(a,"NAND")},or:function(a){return this.logOp(a,"OR")},logOp:function(a,b){return a=d.without(a,null),0===a.length?null:{type:"logOp",operation:b,filters:a}},"boolean":function(b,c){return a(c,{type:"boolean",fieldName:b,value:c})},stringMap:function(b,c,d){return"%%"===d&&(d=""),a(d,{type:"stringMap",fieldName:b,value:d,key:c})},stringEnum:function(b,c){return a(c,{type:"stringEnum",fieldName:b,values:d.flatten(c)})},"long":function(b,c){return a(c,{type:"long",fieldName:b,value:c})},like:function(b,c){return a(c,{type:"like",fieldName:b,like:c})},notNull:function(b){return a(!0,{type:"null",fieldName:b})},dateRange:function(b,c,d){return a(d,a(c,{type:"dateRange",fieldName:b,min:c,max:d}))}}};f.Filter=M;var N=f.Model.extend({endpoint:"gofer/filter/rest/filterHolders",defaults:function(){return{aclEntries:[],filter:null,group:"",name:"",version:0,filterValues:{},customUrlParams:{}}},_parseFilterToValuesAndUrlParams:function(a,b){return b=b||{},"logOp"===a.type?(a.filters.forEach(function(a){this._parseFilterToValuesAndUrlParams(a,b)},this),b):("__filterValues__"===a.fieldName&&(b.filterValues=JSON.parse(a.value)),"__customUrlParams__"===a.fieldName&&(b.customUrlParams=JSON.parse(a.value)),b)},parse:function(){var a=f.Model.prototype.parse.apply(this,arguments),b=a.data||a,c=this._parseFilterToValuesAndUrlParams(b.filter,{});return c.filterValues&&(b.filterValues=c.filterValues),c.customUrlParams&&(b.customUrlParams=c.customUrlParams),b},beforeSave:function(a){var b=f.authenticatedUser.get("uuid");b&&a.aclEntries.push(b+":rw"),a.version+=1;var c=[];if(d.size(a.filterValues)>0){var e=(new f.Filter).string("__filterValues__",JSON.stringify(a.filterValues));c.push(e)}if(d.size(a.customUrlParams)>0){var g=(new f.Filter).string("__customUrlParams__",JSON.stringify(a.customUrlParams));c.push(g)}return c.length>0&&(a.filter=(new f.Filter).or(c)),delete a.totalAmount,delete a.filterValues,delete a.customUrlParams,a},isValid:function(){var a=this.get("name"),b=this.get("filterValues"),c=this.get("customUrlParams");return a&&a.length>0&&(b&&d.size(b)>0||c&&d.size(c)>0)}});f.FilterHolder=N;var O=f.Collection.extend({endpoint:"gofer/filter/rest/filterHolders",model:f.FilterHolder,filterableOptions:function(){return{sortOrder:"+name",filterValues:{type:""},customUrlParams:{getNonpagedCount:!0},filterDefinition:function(){var a=new f.Filter;return a.string("group",this.filterValues.type)}}},parse:function(a){return a.data.items},getType:function(){return this._type},constructor:function(a,b){var c=f.Collection.prototype.constructor.apply(this,arguments);return d.isString(b)&&(this.filterable.setFilters({type:b}),this._type=b,this.on("add",function(a){a.set({group:b})})),c}});f.FilterHolders=O,a.mCAP=f}(this,Backbone,$,_);