!function(a,b,c,d){"use strict";var e=b.sync,f={};b.$=b.$||c,b.$.ajaxSetup({xhrFields:{withCredentials:!0}}),b.sync=function(a,c,f){return d.isUndefined(f.wait)&&(f.wait=!0),e.apply(b,[a,c,f])},f.MCAP="MCAP",f.APNS="APNS",f.GCM="GCM",f.ASSET="ASSET",f.CHANNEL="CHANNEL",f.PIPELINE="PIPELINE",f.SERVICE_CONNECTION="SERVICE_CONNECTION",f.META_MODEL="META_MODEL",f.SCHEDULER_TASK="SCHEDULER_TASK",f.PUSH_SERVICE="PUSH_SERVICE",f.FILE="d5b8e89f-b912-4c93-a419-866445dd3df3",f.FOLDER="73a7cf45-10b1-4636-84c0-22b5a99692e1",f.STUDIO="F4C7059E-B62B-4600-A7BC-B0CC43E75465",f.Utils={},f.Utils.getComponentType=function(a){return f.PushApp.prototype.isPrototypeOf(a)?f.PUSH_SERVICE:void 0},f.Utils.setAuthenticationEvent=function(a){var b=a.error;return a.error=function(a,c,d){401===a.status&&f.authentication._triggerEvent("unauthorized",arguments),"function"==typeof b&&b(a,c,d)},a},f.Utils.request=function(a){var b={url:a.url,dataType:a.dataType||"",data:a.data||{t:(new Date).getTime()}};return a.method&&(b.method=a.method),a.contentType&&(b.contentType=a.contentType),a.timeout&&(b.timeout=a.timeout),c.ajax(b)};var g=function(a,c){c=c||{};var e,f=a,g=c.limit,h=g?c.offset:!1,i=c.page||1,j=c.perPage||30,k=c.filterValues?JSON.parse(JSON.stringify(c.filterValues)):c.filterValues,l=c.filterDefinition,m=c.sortOrder;this.filterValues=c.filterValues,this.customUrlParams=c.customUrlParams,this.getRequestParams=function(a,b,c){if(c.params=c.params||{},"read"===a){var e=this.getFilters();return e&&(c.params.filter=e),j&&i&&(g||d.isUndefined(g))&&(c.params.limit=j,c.params.offset=i>1?j*(i-1):0),m&&(c.params.sortOrder=m),(g||h)&&(c.params.limit=g,c.params.offset=h),this.customUrlParams&&d.extend(c.params,this.customUrlParams),c}},this.setTotalAmount=function(a){e=a},this.getTotalAmount=function(){return e},this.loadPreviousPage=function(){i-=1,f.fetch({remove:!1})},this.hasPreviousPage=function(){return i>=1},this.loadNextPage=function(){i+=1,f.fetch({remove:!1})},this.hasNextPage=function(){return e&&e>f.length},this.getPage=function(){return i},this.getTotalPages=function(){return Math.floor(e/j)},this.setSortOrder=function(a){m=a},this.getSortOrder=function(){return m},this.setFilters=function(a){d.forEach(a,function(a,b){if(!d.has(this.filterValues,b))throw new Error("Filter named '"+b+"' not found, did you add it to filterValues of the model?");this.filterValues[b]=a},this)},this.getFilters=function(){return d.isFunction(l)?l.apply(this):void 0},this.resetFilters=function(){this.filterValues=k?JSON.parse(JSON.stringify(k)):k},function(){if(!f instanceof b.Collection)throw new Error("First parameter has to be the instance of a collection")}()},h=function(a,c){var d=a,e=c.selected||[],f=c.radio===!0;this.getSelectedModels=function(){var a=[];return d.models.forEach(function(b){b.selectable&&b.selectable.isSelected()&&a.push(b)}),a},this.getDisabledModels=function(){var a=[];return d.models.forEach(function(b){b.selectable&&b.selectable.isDisabled()&&a.push(b)}),a},this.allModelsSelected=function(){var a=this.getDisabledModels().length;return this.getSelectedModels().length===d.length-a},this.allModelsDisabled=function(){var a=!0;return d.models.forEach(function(b){b.selectable&&a&&(a=b.selectable.isDisabled())}),a},this.toggleSelectAllModels=function(){this.allModelsSelected()?this.unSelectAllModels():this.selectAllModels()},this.selectAllModels=function(){d.models.forEach(function(a){a.selectable&&a.selectable.select()})},this.selectModels=function(a){a.forEach(function(a){var b=d.findWhere({uuid:a.id});b&&b.selectable&&b.selectable.select()})},this.reset=function(){this.unSelectAllModels(),this.selectModels(e)},this.unSelectAllModels=function(){this.getSelectedModels().forEach(function(a){a.selectable&&a.selectable.unSelect()})},this.isRadio=function(){return f},function(c){if(a.on("add",function(){c.selectModels(e)}),!d instanceof b.Collection)throw new Error("First parameter has to be the instance of a collection")}(this)},i=function(a,c){var d=a,e=c.selected||!1;this.isDisabled=function(){return c.isDisabled?c.isDisabled.apply(a,arguments):!1},this.isSelected=function(){return e},this.select=function(){this.isDisabled()?e=!1:(d.collection&&d.collection.selectable.isRadio()&&d.collection.selectable.unSelectAllModels(),e=!0)},this.unSelect=function(){e=!1},this.toggleSelect=function(){this.isSelected()?this.unSelect():this.select()},function(){if(!d instanceof b.Model)throw new Error("First parameter has to be the instance of a collection")}()},i=i||{},h=h||{},j=function(a,c){return a instanceof b.Model?new i(a,c):a instanceof b.Collection?new h(a,c):void 0},j=j||{},k=b.Model.extend({idAttribute:"uuid",selectable:!0,selectableOptions:{},queryParameter:null,constructor:function(){return this.on("destroy",function(){this.collection&&this.collection.filterable&&this.collection.filterable.getTotalAmount()>0&&this.collection.filterable.setTotalAmount(this.collection.filterable.getTotalAmount()-1)},this),this.selectable&&(this.selectable=new j(this,d.result(this,"selectableOptions"))),"string"==typeof this.endpoint&&this.setEndpoint(this.endpoint),d.bindAll(this,"_markToRevert","revert"),this._markToRevert(arguments[0]||{}),b.Model.prototype.constructor.apply(this,arguments)},setQueryParameter:function(a,b){this.queryParameter=this.queryParameter||{},"string"==typeof a&&(this.queryParameter[a]=b)},removeQueryParameter:function(a){this.queryParameter&&a&&this.queryParameter[a]&&delete this.queryParameter[a]},setEndpoint:function(a){this.urlRoot=function(){return"/"===f.application.get("baseUrl").slice(-1)&&"/"===a[0]?f.application.get("baseUrl")+a.substr(1):"/"!==f.application.get("baseUrl").slice(-1)&&"/"!==a[0]?f.application.get("baseUrl")+"/"+a:f.application.get("baseUrl")+a}},parse:function(a){return a&&a.data&&a.data.results&&a.data.results.length>=0&&"undefined"!=typeof a.data.results[0]?a.data.results[0]:a},url:function(){var a=b.Model.prototype.url.apply(this,arguments);return this.queryParameter&&(a+="?"+b.$.param(this.queryParameter)),a},initialize:function(){return b.Model.prototype.initialize.apply(this,arguments)},revert:function(){this._revertAttributes&&(this.attributes=JSON.parse(JSON.stringify(this._revertAttributes)))},_markToRevert:function(a){this._revertAttributes=JSON.parse(JSON.stringify(a||this.attributes))},isInSync:function(){return d.isEqual(this._revertAttributes,this.attributes)},beforeSave:function(a){return a},save:function(a,c,e){var f=this._save(a,c,e),g=this.attributes;this.attributes=this.beforeSave(d.clone(g));var h=b.Model.prototype.save.apply(this,f).then(function(a){return a.attributes=g,a});return h},_save:function(a,b,c){("undefined"==typeof a||void 0===a||null===a||"object"==typeof a)&&(c=b),c=d.extend({validate:!0},c);var e=c.success,f=this;return c.success=function(a){f._markToRevert(),e&&e(f,a,c)},("undefined"==typeof a||void 0===a||null===a||"object"==typeof a)&&(b=c),[a,b,c]},fetch:function(a){var c=this._fetch(a);return b.Model.prototype.fetch.apply(this,c)},_fetch:function(a){a=a||{};var b=a.success,c=this;return a.success=function(d){c._markToRevert(),"function"==typeof b&&b(c,d,a)},[a]},_triggerEvent:function(a,b){var c=Array.prototype.slice.call(b,0);c.unshift(a),this.trigger.apply(this,c)},sync:function(){return arguments[2]&&f.Utils.setAuthenticationEvent(arguments[2]),b.Model.prototype.sync.apply(this,arguments)}});f.Model=k;var l=f.Model.extend({endpoint:"/",defaults:{uuid:null,version:-1},increaseVersionNumber:function(){this.attributes.version+=1},decreaseVersionNumber:function(){this.attributes.version-=1},_save:function(a,b,c){("undefined"==typeof a||void 0===a||null===a||"object"==typeof a)&&(c=b),c=d.extend({validate:!0},c);var e=c.error,g=this;return g.increaseVersionNumber(),c.error=function(a){g.decreaseVersionNumber(),e&&e(g,a,c)},("undefined"==typeof a||void 0===a||null===a||"object"==typeof a)&&(b=c),f.Model.prototype._save.call(this,a,b,c)}});f.Component=l;var g=g||{},j=j||{},m=b.Collection.extend({selectable:!0,filterable:!0,filterableOptions:{},selectableOptions:{},model:f.Model,constructor:function(){return this.selectable&&(this.selectable=new j(this,d.result(this,"selectableOptions"))),this.filterable&&(this.filterable=new g(this,d.result(this,"filterableOptions"))),this.endpoint&&this.setEndpoint(this.endpoint),b.Collection.prototype.constructor.apply(this,arguments)},setEndpoint:function(a){this.url=function(){return URI(f.application.get("baseUrl")+"/"+a).normalize().toString()}},parse:function(a){return a.data=a.data||{},this.filterable&&this.filterable.setTotalAmount(a.data.total||0),a.data.results},sync:function(a,c,d){if(this.filterable){var e=this.filterable.getRequestParams.apply(this.filterable,arguments);d=e}return d=f.Utils.setAuthenticationEvent(d),b.Collection.prototype.sync.apply(this,[a,c,d])}});f.Collection=m;var n=function(){var a=function(a,b){return d.isUndefined(a)||null===a||""===a?null:b};return{containsString:function(b,c){return a(c,{type:"containsString",fieldName:b,contains:c})},and:function(a){return this.logOp(a,"AND")},nand:function(a){return this.logOp(a,"NAND")},or:function(a){return this.logOp(a,"OR")},logOp:function(a,b){return a=d.without(a,null),0===a.length?null:{type:"logOp",operation:b,filters:a}},"boolean":function(b,c){return a(c,{type:"boolean",fieldName:b,value:c})},like:function(b,c){return a(c,{type:"like",fieldName:b,like:c})}}};f.Filter=n;var o=f.Model.extend({defaults:{baseUrl:"",pushServiceApiVersion:"v1"}});f.application=new o;var p=f.Model.extend({defaults:{userName:"",orgaName:"",password:"",email:"",organization:null,user:null},endpoint:"gofer/security/rest/auth/",login:function(a){var b=this;return"string"==typeof a?this.set("password",a):"object"==typeof a&&this.set(a),this.save(null,{url:this.url()+"login"}).then(function(){return b._triggerEvent("login",arguments),arguments[0]}).fail(function(){return b._triggerEvent("authenticationerror",arguments),arguments}).always(function(){return"string"==typeof a&&b.set("password",""),arguments})},logout:function(){var a=this;return this.save(null,{url:this.url()+"logout"}).always(function(){a._triggerEvent("logout",arguments)})},parse:function(a){var b={};return a&&(a.user&&(b.user=new f.User(a.user)),a.organization&&(b.organization=new f.Organization(a.organization))),b},isAuthenticated:function(){var a=c.Deferred(),b=null;return f.authentication.get("user")&&f.authentication.get("user").get("uuid")?(b=f.authentication.get("user").get("uuid"),f.Utils.request({url:URI(f.application.get("baseUrl")+"/gofer/system/security/currentAuthorization").normalize().toString()}).then(function(c){c.user&&c.user.uuid&&c.user.uuid===b&&a.resolve(c),a.reject("not authenticated",c)}).fail(function(b){a.reject(b)}),a.promise()):(a.reject("no user set"),a.promise())}});f.authentication=new p;var q=f.Model.extend({endpoint:"gofer/security/rest/users",defaults:{uuid:null,name:"",salutation:null,givenName:"",surname:"",position:null,email:"",phone:null,country:null,lastLoggedTime:0,passwordExpires:null,locked:!1,activated:!0,version:0,aclEntries:[],preferences:{},groups:null,roles:[]},parse:function(a){var b=a.data||a;return this.attributes&&!this.attributes.groups&&(b.groups=new f.UserGroups({userId:this.id})),a.data||a},validate:function(){this.attributes.version++},beforeSave:function(a){return delete a.groups,delete a.roles,(""===a.password||null===a.password)&&delete a.password,a},save:function(){return f.Model.prototype.save.apply(this,arguments)}});f.User=q;var r=f.Collection.extend({endpoint:"gofer/security/rest/users",model:f.User,parse:function(a){return a.data.items},filterableOptions:function(){return{sortOrder:"+name",filterValues:{name:""},filterDefinition:function(){var a=new f.Filter;return a.and([a.containsString("name",this.filterValues.name)])}}}});f.Users=r;var s=f.Model.extend({endpoint:"gofer/security/rest/organizations",defaults:{uuid:null,aclEntries:null,name:null,uniqueName:null,address:null,billingSettings:null,technicalPerson:null,assetPath:null,reportLocaleString:null,defaultRoles:null,version:null,effectivePermissions:null}});f.Organization=s;var t=f.Collection.extend({endpoint:"gofer/security/rest/organizations",model:f.Organization,parse:function(a){return a.data.items}});f.Organizations=t;var u=f.Model.extend({endpoint:"gofer/form/rest/enumerables/paginatedPairs/roles",defaults:{uuid:null,name:""}});f.Role=u;var v=f.Collection.extend({endpoint:"gofer/form/rest/enumerables/paginatedPairs/roles",model:f.Role,parse:function(a){var b=a.data.items,c=[];return b.forEach(function(a){c.push({uuid:a.value,name:a.label})}),c}});f.Roles=v;var w=f.Model.extend({endpoint:"gofer/form/rest/enumerables/paginatedPairs/members",defaults:{uuid:null,name:""}});f.Member=w;var x=f.Collection.extend({endpoint:"gofer/form/rest/enumerables/paginatedPairs/members",model:f.Member,parse:function(a){var b=a.data.items,c=[];return b.forEach(function(a){c.push({uuid:a.value,name:a.label})}),c}});f.Members=x;var y=f.Model.extend({endpoint:"gofer/security/rest/groups",defaults:function(){return{uuid:null,name:"",version:0,organizationUuid:"",description:null,roles:new f.Roles,members:new f.Members,aclEntries:[],effectivePermissions:"",sysRoles:[],systemPermission:!1,bundle:null}},validate:function(a){return!a.organizationUuid||a.organizationUuid.length<1?"Missing organization uuid":void this.attributes.version++},beforeSave:function(a){var b=[],c=[];return a.members&&a.members.each(function(a){c.push(a.id)}),a.roles&&a.roles.each(function(a){b.push(a.id)}),a.roles=b,a.members=c,a},parse:function(a){var b=a.data||a,c=new f.Roles(null,{groupId:b.uuid}),d=new f.Members(null,{groupId:b.uuid});return b.roles&&b.roles.forEach(function(a){c.add({uuid:a})}),b.members&&b.members.forEach(function(a){d.add({uuid:a})}),b.roles=c,b.members=d,b}});f.Group=y;var z=f.Collection.extend({endpoint:"gofer/security/rest/groups",model:f.Group,parse:function(a){return a.data.items},filterableOptions:function(){return{sortOrder:"+name",filterValues:{name:"",systemPermission:!1},filterDefinition:function(){var a=new f.Filter,b=[a.containsString("name",this.filterValues.name)];return this.filterValues.systemPermission!==!0&&b.push(a.boolean("systemPermission",this.filterValues.systemPermission)),a.and(b)}}}}),A=z.extend({constructor:function(a){this.endpoint="gofer/security/rest/users/"+a.userId+"/groups",z.prototype.constructor.apply(this,arguments)},parse:function(a){return a.data.groups},create:function(){throw new Error("This method is not supported. Add all models to this collection by calling the add method and call the method save afterwards")},save:function(){var a=d.pluck(this.models,"id");b.ajax({url:this.endpoint,data:a,type:"PUT",success:function(){}})}});f.Groups=z,f.UserGroups=A;var B=f.Collection.extend({endpoint:"",push:null,setEndpoint:function(a){this.url=function(){return URI(this.push.url()+a).normalize().toString()}},initialize:function(a,b){return this.push=b,f.Collection.prototype.initialize.apply(this,arguments)}});f.PushAppAttributeCollection=B;var C=f.Model.extend({idAttribute:"uuid",defaults:{providerType:f.MCAP,user:"",vendor:"",name:"",osVersion:"",language:"de",country:"DE",tags:null,badge:0,appPackageName:null,type:null,appVersion:null,model:null,attributes:null,token:""},initialize:function(a){return this.attributes.tags=a.tags||[],this.attributes.attributes=a.attributes||{},f.Model.prototype.initialize.apply(this,arguments)}});f.Device=C;var D=f.PushAppAttributeCollection.extend({endpoint:"/devices",model:f.Device,parse:function(a){return a&&a.items?a.items:a}});f.Devices=D;var E=f.Model.extend({idAttribute:"uuid",defaults:{message:"",sound:"",deviceFilter:null,badge:0,extras:null},sendPush:function(){return this.save.apply(this,arguments)}});f.Job=E;var F=f.PushAppAttributeCollection.extend({endpoint:"/jobs",model:f.Job,parse:function(a){return a&&a.items?a.items:a}});f.Jobs=F;var G=f.PushAppAttributeCollection.extend({tags:null,endpoint:"/tags",parse:function(a){this.tags=a},get:function(a){return"tag"===a||"tags"===a?this.tags:f.PushAppAttributeCollection.prototype.get.apply(this,arguments)},set:function(a,b){return"tag"===a||"tags"===a?(this.tags=b,this):f.PushAppAttributeCollection.prototype.set.apply(this,arguments)}});f.Tags=G;var H=f.Model.extend({endpoint:"/apnsProvider",defaults:{certificate:null,passphrase:null},initialize:function(a,b){return this.push=b,f.Model.prototype.initialize.apply(this,arguments)},upload:function(){return this.sync()},setEndpoint:function(a){this.url=function(){return URI(this.push.url()+a).normalize().toString()}},sync:function(a,e,f){e=e||this;var g=new FormData;return g.append("passphrase",this.get("passphrase")),g.append("certificate",this.get("certificate")),d.defaults(f||(f={}),{url:this.url(),data:g,type:"PUT",processData:!1,contentType:!1,xhr:function(){var a=c.ajaxSettings.xhr();return a.upload.onprogress=function(a){e.trigger("progress",a.loaded/a.total*100)},a.upload.onload=function(){e.trigger("progress",100)},a}}),b.sync.call(this,a,e,f).then(function(a){return e.push.update(a),arguments})}});f.ApnsProvider=H;var I=f.Component.extend({endpoint:"push/api/"+f.application.get("pushServiceApiVersion")+"/apps/",idAttribute:"uuid",defaults:{uuid:null,name:"",apnsProvider:null,gcmProvider:null,version:-1,effectivePermissions:"*"},tags:null,jobs:null,devices:null,initialize:function(){var a=this,b=function(){return a.url()},c=function(b){return a.set("apnsProvider",b)};return this.tags=new f.Tags(null,{url:b}),this.jobs=new f.Jobs(null,{url:b}),this.devices=new f.Devices(null,{url:b}),this.apnsProvider=new f.ApnsProvider(null,{url:b,update:c}),f.Model.prototype.initialize.apply(this,arguments)},fetch:function(){return c.when(this.devices.fetch(),this.tags.fetch(),this.jobs.fetch(),f.Model.prototype.fetch.apply(this,arguments))}});f.PushApp=I;var J=f.Collection.extend({endpoint:"push/api/"+f.application.get("pushServiceApiVersion")+"/apps/",model:f.PushApp,parse:function(a){return a&&a.items?a.items:a}});f.PushApps=J,f.push=new f.PushApp,f.PushNotification=function(a){a=a||{};var b=this,c={};a.pushServiceId?c.uuid=a.pushServiceId:console.info("no pushServiceId was given to the PushNotification. Please specify one to use the API"),this.pushApp=new f.PushApp(c),delete a.pushServiceId,this.senderId="undefined"!=typeof a.senderId?a.senderId:this.senderId,delete a.senderId,this.device=this.pushApp.devices.add(a,{url:function(){return b.pushApp.url()}})},f.PushNotification.prototype.trigger=b.Model.prototype.trigger,f.PushNotification.prototype.on=b.Model.prototype.on,f.PushNotification.prototype.off=b.Model.prototype.off,f.PushNotification.prototype.senderId=null,f.PushNotification.prototype.pushApp=null,f.PushNotification.prototype.device=null,f.PushNotification.prototype.set=function(a,b){return"pushServiceId"===a?this.pushApp.set("uuid",b):"senderId"===a?this.senderId=b:this.device.set(a,b),this},f.PushNotification.prototype.get=function(a){return"undefined"!=typeof this.device.get(a)?this.device.get(a):"undefined"!=typeof this.pushApp.get(a)?this.pushApp.get(a):"pushServiceId"===a?this.pushApp.get("uuid"):"senderId"===a?this.senderId:null},f.PushNotification.prototype.getConfiguration=function(){return this.pushApp.toJSON()},f.PushNotification.prototype.addAttribute=function(a,b){return this.device.attributes.attributes[a]=b,this},f.PushNotification.prototype.removeAttribute=function(a){return delete this.device.attributes.attributes[a],this},f.PushNotification.prototype.addAttributes=function(a){return this.device.attributes.attributes=d.extend(this.device.attributes.attributes,a),this},f.PushNotification.prototype.removeAttributes=function(a){return"string"==typeof a&&(a=Array.prototype.slice.call(arguments,0)),a.unshift(this.device.attributes.attributes),this.device.attributes.attributes=d.omit.apply(d,a),this},f.PushNotification.prototype.putAttributeValue=function(a,b){return this.addAttribute(a,b),this},f.PushNotification.prototype.addTag=function(a){return this.addTags([a]),this},f.PushNotification.prototype.removeTag=function(a){return this.removeTags([a])},f.PushNotification.prototype.addTags=function(a){return this.device.attributes.tags=d.union(this.device.attributes.tags,a||[]),this},f.PushNotification.prototype.removeTags=function(a){return this.device.attributes.tags=d.difference(this.device.attributes.tags,a||[]),this},f.PushNotification.prototype.subscribeTag=function(a){return this.addTag(a),this},f.PushNotification.prototype.subscribeTags=function(a){return this.addTags(a),this},f.PushNotification.prototype.setAttributes=function(a,b){return this.addAttribute(a,b),this},f.PushNotification.prototype.setCountry=function(a){return this.set("country",a),this},f.PushNotification.prototype.setCurrentBadge=function(a){return this.set("badge",a),this},f.PushNotification.prototype.setToken=function(a){return this.set("token",a),this},f.PushNotification.prototype.setLanguage=function(a){return this.set("language",a),this},f.PushNotification.prototype.setModel=function(a){return this.set("model",a),this},f.PushNotification.prototype.setUser=function(a){return this.set("name",a),this},f.PushNotification.prototype.unsubscribeTag=function(a){return this.removeTag(a),this},f.PushNotification.prototype.unregisterDevice=function(){if(this.device.isNew()){var a=new c.Deferred;return a.reject("device was not saved before"),a.promise()}return this.device.destroy()},f.PushNotification.prototype.registerDevice=function(){return this.device.save()},f.PushNotification.prototype.save=function(){return this.device.save()},f.PushNotification.prototype.sendStatusBarNotification=function(){return console.info("needs to be implemented by the specific implementation"),this},f.PushNotification.prototype.showToastNotification=function(){return console.info("needs to be implemented by the specific implementation"),this},f.PushNotification.prototype.updateDeviceBadge=function(){return console.info("needs to be implemented by the specific implementation"),this},f.PushNotification.prototype.register=function(){return console.info("needs to be implemented by the specific implementation"),this},f.PushNotification.prototype.unregister=function(){return console.info("needs to be implemented by the specific implementation"),this},a.mCAP=f}(this,Backbone,$,_);